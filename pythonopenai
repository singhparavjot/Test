# Process metric data, simplifying the loop logic
foreach ($metric in $metricData.Data) {
    foreach ($timeseries in $metric.Timeseries) {
        # Check if the deployment name matches in the metadata values
        $isMatchingDeployment = $false
        foreach ($dimension in $timeseries.Metadatavalues) {
            if ($dimension.Name -eq "ModelDeploymentName" -and $dimension.Value -eq $deploymentName) {
                $isMatchingDeployment = $true
                break
            }
        }

        # If we have a matching deployment, sum the Total values
        if ($isMatchingDeployment) {
            foreach ($data in $timeseries.Data) {
                if ($data.Total -ne $null) {
                    $totalTokens += $data.Total
                }
            }
        }
    }
}
