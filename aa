import tableauserverclient as TSC
import argparse

def main():
    parser = argparse.ArgumentParser(description="List workbooks in a Tableau project.")
    parser.add_argument("--server", required=True, help="Tableau Server URL")
    parser.add_argument("--username", required=True, help="Username for Tableau Server")
    parser.add_argument("--password", required=True, help="Password for Tableau Server")
    parser.add_argument("--site", required=True, help="Tableau site name (e.g., 'dev')")
    parser.add_argument("--project", required=True, help="Project name to list workbooks from")
    args = parser.parse_args()

    # Authenticate to Tableau Server
    tableau_auth = TSC.TableauAuth(args.username, args.password, args.site)
    server = TSC.Server(args.server, use_server_version=True)

    with server.auth.sign_in(tableau_auth):
        # Fetch all projects
        all_projects, _ = server.projects.get()
        project = next((proj for proj in all_projects if proj.name == args.project), None)

        if not project:
            print(f"Project '{args.project}' not found.")
            return

        # Fetch all workbooks in the specified project
        req_options = TSC.RequestOptions()
        req_options.filter.add(TSC.Filter(TSC.RequestOptions.Field.ProjectID, TSC.RequestOptions.Operator.Equals, project.id))

        all_workbooks, _ = server.workbooks.get(req_options)
        print(f"Workbooks in Project '{args.project}':")
        for workbook in all_workbooks:
            print(f"- {workbook.name} (ID: {workbook.id})")

if __name__ == "__main__":
    main()
