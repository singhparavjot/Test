from flask import Flask, jsonify
from azure.identity import DefaultAzureCredential
from azure.storage.blob import BlobServiceClient
import logging

# Set up logging
logging.basicConfig(level=logging.INFO)

app = Flask(__name__)

# Define the Storage Account details
STORAGE_ACCOUNT_URL = "https://your-storage-account-name.blob.core.windows.net"
CONTAINER_NAME = "your-container-name"  # Replace with the name of your container

# Set up the DefaultAzureCredential to use Managed Identity
credential = DefaultAzureCredential()

# Initialize BlobServiceClient with managed identity credential
blob_service_client = BlobServiceClient(account_url=STORAGE_ACCOUNT_URL, credential=credential)

@app.route('/')
def list_blobs():
    try:
        # Access the specified container
        container_client = blob_service_client.get_container_client(CONTAINER_NAME)
        
        # List blobs in the container
        blobs = container_client.list_blobs()
        blob_names = [blob.name for blob in blobs]  # Collect blob names

        return jsonify(blob_names)  # Return the list of blob names as JSON

    except Exception as e:
        logging.error(f"Error: {str(e)}")
        return "An error occurred. Check the logs for details.", 500

if __name__ == '__main__':
    app.run(debug=True)
