trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  tableauServer: 'http://<your-tableau-server>'
  tableauUsername: $(TableauUser)
  tableauPassword: $(TableauPass)

steps:
- script: |
    echo "Downloading Tabcmd..."
    wget -O tabcmd-installer.deb https://downloads.tableau.com/releases/tabcmd/2023.2.0/tabcmd-2023-2-0_amd64.deb
    
    echo "Installing Tabcmd..."
    sudo dpkg -i tabcmd-installer.deb || sudo apt-get -f install -y  # Handle missing dependencies
    
    echo "Cleaning up installer..."
    rm tabcmd-installer.deb
  displayName: 'Install Tabcmd on Ubuntu'

- script: |
    echo "Verifying Tabcmd installation..."
    tabcmd --version
  displayName: 'Verify Tabcmd Installation'

- script: |
    echo "Logging into Tableau Server..."
    tabcmd login -s $(tableauServer) -u $(tableauUsername) -p $(tableauPassword)

    echo "Exporting workbook from dev site..."
    tabcmd get "/workbooks/<workbook-name>.twbx" -f dev_workbook.twbx

    echo "Publishing workbook to prod site..."
    tabcmd publish "dev_workbook.twbx" --project "Production Project" --name "<workbook-name>" --overwrite

    echo "Logging out from Tableau Server..."
    tabcmd logout
  displayName: 'Run Tabcmd Commands'
